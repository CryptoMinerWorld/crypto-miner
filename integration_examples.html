<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Crypto Miner World: Integration Examples</title>
	<style>
		* {
			font-family: monospace;
		}
		input[type=button] {
			border-radius: 4px;
			background: #F0F0F0;
			box-shadow: 1px 1px 1px 1px silver;
		}
		input[type=button]:active {
			box-shadow: none;
		}
	</style>
	<script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
</head>
<body>
<fieldset><legend>Connection Settings</legend>
	<table>
		<tr>
			<td><label for="TokenAddress" title="Deployed Instance Address">Gem (ERC721 Token) Instance Address:</label></td>
			<td><input id="TokenAddress" type="text" value="0xb9fd306efe737736a05a9d558543ec848b8a245c" size="42"/></td>
		</tr>
		<tr>
			<td><label for="SaleAddress" title="Geode Sale Instance Address">Geode Sale Instance Address:</label></td>
			<td>
				<input id="SaleAddress" type="text" value="0x9042ef6d8e62ac84d45558c2de0aacae07efbf18" size="42" readonly/>
				<input type="button" value="Buy Geode" onclick="buy()"/>
			</td>
		</tr>
		<tr>
			<td></td>
			<td><input type="button" value="Connect" onclick="connect_gem()"/></td>
		</tr>
	</table>
</fieldset>
<fieldset><legend>Mint a Gem</legend>
	<table>
		<tr>
			<td><label for="mint_gem_id">Gem UID:</label></td>
			<td><input id="mint_gem_id" type="text" size="21"/></td>
		</tr>
		<tr>
			<td><label for="mint_owner">Gem Owner Address:</label></td>
			<td><input id="mint_owner" type="text" size="42" value="0xEd6003e7A6494Db4ABabEB7bDf994A3951ac6e69"/></td>
		</tr>
		<tr><td></td><td><input type="button" value="Mint" onclick="mint()"/></td></tr>
	</table>
</fieldset>
<fieldset><legend>Burn the Gem</legend>
	<table>
		<tr>
			<td><label for="burn_gem_id">Gem UID:</label></td>
			<td><input id="burn_gem_id" type="text" size="21"/></td>
		</tr>
		<tr><td></td><td><input type="button" value="Burn" onclick="burn()"/></td></tr>
	</table>
</fieldset>
<fieldset><legend>Transfer a Gem</legend>
	<table>
		<tr>
			<td><label for="transfer_gem_id">Gem UID:</label></td>
			<td><input id="transfer_gem_id" type="text" size="21"/></td>
		</tr>
		<tr>
			<td><label for="transfer_to">Transfer To Address:</label></td>
			<td><input id="transfer_to" type="text" size="42" value="0x2f4Fe9f655FF9316335D7200169Cd07d598ff7BC"/></td>
		</tr>
		<tr><td></td><td><input type="button" value="Transfer" onclick="transfer()"/></td></tr>
	</table>
</fieldset>
<fieldset><legend>Console <input type="button" value="Clear Console" onclick="document.getElementById('console').innerHTML = '';"/></legend>
	<pre id="console"></pre>
</fieldset>
</body>
<script type="text/javascript" src="web3_integration.js"></script>
<script type="text/javascript">

function mint() {
	if(!(myWeb3 && gemABI && myAccount && gemInstance)) {
		printError("Not connected to a Gem (ERC721 Token) Instance");
		return;
	}
	const gemId = document.getElementById("mint_gem_id").value;
	const owner = document.getElementById("mint_owner").value;
	if(!myWeb3.isAddress(owner)) {
		printError("Please provide a valid Gem Owner Address");
		return;
	}
	gemInstance.exists(gemId, function(err, exists) {
		if(err) {
			printError("Cannot check if gem doesn't exist: " + err);
			return;
		}
		if(exists) {
			printError("Gem " + gemId + " already exists!");
			return;
		}
		gemInstance.mint.sendTransaction(gemId, owner, function(err, txHash) {
			if(err) {
				printError("Mint transaction failed: " + err.toString().split("\n")[0]);
				return;
			}
			printLog("Mint transaction sent: " + txHash);
		});
	});
}

function burn() {
	if(!(myWeb3 && gemABI && myAccount && gemInstance)) {
		printError("Not connected to a Gem (ERC721 Token) Instance");
		return;
	}
	const gemId = document.getElementById("burn_gem_id").value;
	gemInstance.exists(gemId, function(err, exists) {
		if(err) {
			printError("Cannot check if gem exists: " + err);
			return;
		}
		if(!exists) {
			printError("Gem " + gemId + " doesn't exist!");
			return;
		}
		gemInstance.burn.sendTransaction(gemId, function(err, txHash) {
			if(err) {
				printError("Burn transaction failed: " + err.toString().split("\n")[0]);
				return;
			}
			printLog("Burn transaction sent: " + txHash);
		});
	});
}

function transfer() {
	if(!(myWeb3 && gemABI && myAccount && gemInstance)) {
		printError("Not connected to a Gem (ERC721 Token) Instance");
		return;
	}
	const gemId = document.getElementById("transfer_gem_id").value;
	const to = document.getElementById("transfer_to").value;
	if(!myWeb3.isAddress(to)) {
		printError("Please provide a valid Transfer To Address");
		return;
	}
	gemInstance.exists(gemId, function(err, exists) {
		if(err) {
			printError("Cannot check if gem exists: " + err);
			return;
		}
		if(!exists) {
			printError("Gem " + gemId + " doesn't exist!");
			return;
		}
		gemInstance.ownerOf(gemId, function(err, owner) {
			if(err) {
				printError("Cannot get the owner a gem: " + err);
				return;
			}
			if(owner !== myAccount) {
				printError("You cannot transfer other's owner gem. Gem " + gemId + " belongs to " + owner);
				return;
			}
			gemInstance.transfer.sendTransaction(to, gemId, function(err, txHash) {
				if(err) {
					printError("Transfer transaction failed: " + err.toString().split("\n")[0]);
					return;
				}
				printLog("Transfer transaction sent: " + txHash);
			});
		});
	});
}


</script>
</html>